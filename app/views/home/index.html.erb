<span class='home_intro app_color'><%= flash[:notice] %></span>

<table>
  <tr>
    <% if current_user.practice %>
      <td valign="top" style='width: 5.0in'>
        <table class='light_pink'>
          <tr>
            <th colspan='3'>My Practice</th>
          </tr>
          <tr>
            <td rowspan='2' class='label_light' align="center">
              Practice<br>Members
            </td>
            <td class='label_light' align="center" colspan='2'>30 day stats</td>
          </tr>
          <tr>
            <td class='label_light' align="center">
              Visits
            </td>
            <td class='label_light' align="center">
              Active PMs
            </td>
          </tr>

          <tr>
            <td class='stat' align="center">
              <p class='big'><%= local_practice_member_count = current_user.practice.my_practice_members.size %></p>
            </td>
            <td class='stat' align="center">
              <p class='big'><%= thirty_day_visit_count = current_user.practice.visit_count(30.days) %></p>
            </td>
            <td class='stat' align="center">
              <p class='big'><%= PracticeMember.joins(:visits).select('DISTINCT practice_members.id').where('visits.date>=? AND practice_id=?', (DateTime.now-30.days), current_user.practice.id).count %></p>
            </td>
          </tr>
        </table>
      </td>
    <% else %>
      <% if current_user.role.name == 'sysadmin' %>
        <td valign="top" style='width: 5.0in'>
          <table class='light_pink'>
            <tr>
              <th colspan='3'>SYSADMIN</th>
            </tr>
            <tr>
              <td class='label_light' align="center">
                Practices/today
              </td>
              <td align="center" colspan='2'><%= Practice.count %>/<%= Practice.where('created_at >= ?', Time.zone.now-1.day).all.count %></td>
            </tr>
            <tr>
              <td class='label_light' align="center">
                PMs/today
              </td>
              <td align="center" colspan='2'><%= PracticeMember.count %>/<%= PracticeMember.where('created_at >= ?', Time.zone.now-1.day).all.count %></td>
            </tr>
            <tr>
              <td class='label_light' align="center">
                Visits/today
              </td>
              <td align="center" colspan='2'><%= Visit.count %>/<%= Visit.where('created_at >= ?', Time.zone.now-1.day).all.count %></td>
            </tr>
            <tr>
              <td class='label_light' align="center">
                Users/today
              </td>
              <td align="center" colspan='2'><%= User.count %>/<%= User.where('created_at >= ?', Time.zone.now-1.day).all.count %></td>
            </tr>
            <tr>
              <td class='label_light' align="center" colspan='2'>
                System Errors
              </td>
            </tr>
            <% if SystemError.count > 0 %>
              <% SystemError.order('created_at').all.each do |system_error| %>
                <tr>
                  <td align="center" colspan='2'><%= system_error.created_at %><br><%= system_error.user.email if system_error.user %><br><%= system_error.error %><br><%= system_error.incidentals %></td>
                </tr>
              <% end %>
            <% else %>
              <tr><td align="center" colspan='2'>None</td></tr>
            <% end %>
          </table>
        </td>
      <% end %>
    <% end %>

    <td valign='top'>
      <table class='light_green'>
        <tr>
          <th>
            Community
          </th>
        </tr>
        <tr>
          <td>
            The cost and future development of this system depend on you! Please refer other Practitioners!
            See <a href='/about#community_driven_project_background_and_business_case' target='new'>Community Driven Project</a> or watch our video:</p>
            <iframe width="350" height="215" src="http://www.youtube.com/embed/5DAjIO96U20" frameborder="0" allowfullscreen></iframe>
          </td>
        </tr>
        <tr>
          <td>
            <div id='invitation'>
              <%= render :partial => 'invitations/invitation' %>
            </div>
          </td>
        </tr>
      </table>
    </td>





<!--
    <td valign='top'>
      <table class='light_green'>
        <tr>
          <th colspan="3">
            Systemwide
          </th>
        </tr>
        <tr>
          <td class='label_light' align="center">
            Practices
          </td>
          <td class='label_light' align="center">
            Practice<br>Memebers
          </td>
          <td class='label_light' align="center">
            Visits<br>30 days
          </td>
        </tr>
        <tr>
          <td class='stat' align="center">
            <p class='big'>< Practice.where("name<>'Demo Practice'").all.size %></p>
          </td>
          <td class='stat' align="center">
            <p class='big'>< PracticeMember.practice_members_global_count %></p>
          </td>
          <td class='stat' align="center">
            <p class='big'>< Visit.where('created_at >= ?', DateTime.now-30.days).count %></p>
          </td>
        </tr>
      </table>
    </td>
-->
  </tr>
</table>



